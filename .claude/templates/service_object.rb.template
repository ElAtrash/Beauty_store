# Service Object Template
# Usage: Extract complex business logic into focused, testable service objects

class {{service_name}}Service
  # Result object for success/failure handling
  Result = Struct.new(:success?, :data, :error, :errors, keyword_init: true) do
    def self.success(data = nil)
      new(success?: true, data: data)
    end

    def self.failure(error, errors = [])
      new(success?: false, error: error, errors: errors)
    end

    def failure?
      !success?
    end
  end

  def initialize({{constructor_params}})
    {{param_assignments}}
  end

  def call
    {{validation_checks}}

    {{main_transaction_block}}
  rescue => error
    Rails.logger.error "{{service_name}}Service failed: #{error.message}"
    Result.failure(error.message)
  end

  private

  {{private_attr_readers}}

  def {{validation_method_name}}
    return Result.success if {{validation_condition}}
    
    Result.failure("{{validation_error_message}}")
  end

  def {{main_operation_method}}
    {{main_operation_logic}}
  end

  def {{secondary_operation_method}}
    {{secondary_operation_logic}}
  end

  def {{cleanup_method}}
    {{cleanup_logic}}
  end
end

# Template Variables:
# {{service_name}} - Name of the service (e.g., CreateOrder, ProcessPayment)
# {{constructor_params}} - Service constructor parameters
# {{param_assignments}} - Instance variable assignments
# {{validation_checks}} - Early validation/guard clauses
# {{main_transaction_block}} - Main operation wrapped in transaction
# {{private_attr_readers}} - Private attr_reader declarations
# {{validation_method_name}} - Name of validation method
# {{validation_condition}} - Condition for successful validation
# {{validation_error_message}} - Error message for failed validation
# {{main_operation_method}} - Primary business logic method name
# {{main_operation_logic}} - Core business operation code
# {{secondary_operation_method}} - Supporting operation method name
# {{secondary_operation_logic}} - Supporting operation code
# {{cleanup_method}} - Cleanup/notification method name
# {{cleanup_logic}} - Cleanup operations (emails, notifications, etc.)

# Example Usage:
# result = CreateOrderService.new(user, cart_items, payment_params).call
# if result.success?
#   redirect_to result.data, notice: 'Order created successfully!'
# else
#   flash[:error] = result.error
#   render :new
# end