<div class="filter-popup-overlay opacity-0 pointer-events-none"
     data-<%= controller_name %>-target="filterPopupOverlay"
     data-action="click-><%= controller_name %>#closeFilters">
</div>

<div class="filter-popup-panel -translate-x-full"
     data-<%= controller_name %>-target="filterPopupPanel">
  <div class="flex flex-col h-full">
    <div class="flex items-center justify-between p-6 pb-8">
      <h2 class="text-xl font-semibold">Filters</h2>
      <button class="p-2 text-subtle hover:text-interactive transition-colors"
              data-action="click-><%= controller_name %>#closeFilters"
              aria-label="Close filters">
        <%= render IconComponent.new(name: :close, class: "w-6 h-6") %>
      </button>
    </div>

    <div class="flex-1 overflow-y-auto">
      <div class="p-6 space-y-3">
        <!-- In Stock Toggle -->
        <% if filter_form.filter_available?(:in_stock) %>
          <div class="filter-section">
            <div class="flex items-center justify-between">
              <label for="in_stock" class="text-base font-medium">In Stock</label>
              <div class="filter-toggle-switch">
                <input type="checkbox"
                       id="in_stock"
                       name="filters[in_stock]"
                       <%= 'checked' if in_stock_selected? %>
                       data-action="change-><%= controller_name %>#updateFilter"
                       data-filter-type="in_stock"
                       class="sr-only">
                <label for="in_stock" class="toggle-label">
                  <span class="toggle-slider"></span>
                </label>
              </div>
            </div>
          </div>
        <% end %>

        <!-- Price Range -->
        <% if filter_form.filter_available?(:price_range) %>
          <div class="filter-section">
            <div class="filter-range-container"
                 data-<%= controller_name %>-target="priceRange"
                 data-min="<%= price_range[:min] %>"
                 data-max="<%= price_range[:max] %>"
                 data-current-min="<%= current_min_price %>"
                 data-current-max="<%= current_max_price %>">

              <div class="range-slider-container mb-4">
                <div class="range-slider" data-<%= controller_name %>-target="slider">
                  <div class="range-track"></div>
                  <div class="range-fill" data-<%= controller_name %>-target="rangeFill"></div>
                  <input type="range"
                         class="range-input range-min"
                         min="<%= price_range[:min] %>"
                         max="<%= price_range[:max] %>"
                         value="<%= current_min_price %>"
                         data-<%= controller_name %>-target="rangeMin"
                         data-action="input-><%= controller_name %>#updatePriceRange">
                  <input type="range"
                         class="range-input range-max"
                         min="<%= price_range[:min] %>"
                         max="<%= price_range[:max] %>"
                         value="<%= current_max_price %>"
                         data-<%= controller_name %>-target="rangeMax"
                         data-action="input-><%= controller_name %>#updatePriceRange">
                </div>
              </div>

              <div class="flex items-center justify-between text-sm text-muted">
                <span data-<%= controller_name %>-target="minPriceDisplay">$<%= current_min_price %></span>
                <span data-<%= controller_name %>-target="maxPriceDisplay">$<%= current_max_price %></span>
              </div>
            </div>
          </div>
        <% end %>

        <!-- Product Type -->
        <%= render FilterSectionComponent.new(
              section_id: "product-type",
              title: "Product Type",
              options: product_type_options,
              filter_type: "product_types",
              selected_values: selected_values_for("product_types"),
              controller_name: controller_name
            ) if filter_form.filter_available?(:product_types) %>

        <!-- Brands (only show if not in brand context) -->
        <%= render FilterSectionComponent.new(
              section_id: "brands",
              title: "Brands",
              options: brand_options,
              filter_type: "brands",
              selected_values: selected_values_for("brands"),
              controller_name: controller_name
            ) if filter_form.filter_available?(:brands) %>

        <!-- Colors -->
        <%= render FilterSectionComponent.new(
              section_id: "colors",
              title: "Colors",
              options: available_colors,
              filter_type: "colors",
              selected_values: selected_values_for("colors"),
              controller_name: controller_name
            ) if filter_form.filter_available?(:colors) %>

        <!-- Sizes -->
        <%= render FilterSectionComponent.new(
              section_id: "sizes",
              title: "Sizes",
              options: available_sizes,
              filter_type: "sizes",
              selected_values: selected_values_for("sizes"),
              controller_name: controller_name
            ) if filter_form.filter_available?(:sizes) %>

        <!-- Skin Type -->
        <%= render FilterSectionComponent.new(
              section_id: "skin-type",
              title: "Skin Type",
              options: skin_type_options,
              filter_type: "skin_types",
              selected_values: selected_values_for("skin_types"),
              controller_name: controller_name
            ) if filter_form.filter_available?(:skin_types) %>
      </div>
    </div>

    <div class="p-6">
      <div class="flex gap-3">
        <button type="button"
                class="btn-secondary flex-1 disabled:opacity-50 disabled:cursor-not-allowed"
                data-<%= controller_name %>-target="resetButton"
                data-action="click-><%= controller_name %>#resetFilters">
          Reset
        </button>
        <button type="button"
                class="flex-1 px-4 py-2 bg-text-primary text-white hover:bg-interactive-primary transition-colors"
                data-action="click-><%= controller_name %>#applyFilters">
          Apply Filters
        </button>
      </div>
    </div>
  </div>
</div>
