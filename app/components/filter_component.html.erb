<div class="filter-popup-overlay opacity-0 pointer-events-none"
     data-<%= controller_name %>-target="filterPopupOverlay"
     data-action="click-><%= controller_name %>#closeFilters">
</div>

<div class="filter-popup-panel -translate-x-full"
     data-<%= controller_name %>-target="filterPopupPanel">
  <div class="flex flex-col h-full">
    <div class="flex items-center justify-between p-6 pb-8">
      <h2 class="text-xl font-semibold">Filters</h2>
      <button class="p-2 text-subtle hover:text-muted transition-colors"
              data-action="click-><%= controller_name %>#closeFilters"
              aria-label="Close filters">
        <%= render IconComponent.new(name: :close, class: "w-6 h-6") %>
      </button>
    </div>

    <div class="flex-1 overflow-y-auto">
      <div class="p-6 space-y-3">
        <!-- In Stock Toggle -->
        <% if filter_form.filter_available?(:in_stock) %>
          <div class="filter-section">
            <div class="flex items-center justify-between">
              <label for="in_stock" class="text-base font-medium">In Stock</label>
              <div class="filter-toggle-switch">
                <input type="checkbox"
                       id="in_stock"
                       name="filters[in_stock]"
                       <%= 'checked' if in_stock_selected? %>
                       data-action="change-><%= controller_name %>#updateFilter"
                       data-filter-type="in_stock"
                       class="sr-only">
                <label for="in_stock" class="toggle-label">
                  <span class="toggle-slider"></span>
                </label>
              </div>
            </div>
          </div>
        <% end %>

        <!-- Price Range -->
        <% if filter_form.filter_available?(:price_range) %>
          <div class="filter-section">
            <div class="filter-range-container"
                 data-<%= controller_name %>-target="priceRange"
                 data-min="<%= price_range[:min] %>"
                 data-max="<%= price_range[:max] %>"
                 data-current-min="<%= current_min_price %>"
                 data-current-max="<%= current_max_price %>">

              <div class="range-slider-container mb-4">
                <div class="range-slider" data-<%= controller_name %>-target="slider">
                  <div class="range-track"></div>
                  <div class="range-fill" data-<%= controller_name %>-target="rangeFill"></div>
                  <input type="range"
                         class="range-input range-min"
                         min="<%= price_range[:min] %>"
                         max="<%= price_range[:max] %>"
                         value="<%= current_min_price %>"
                         data-<%= controller_name %>-target="rangeMin"
                         data-action="input-><%= controller_name %>#updatePriceRange">
                  <input type="range"
                         class="range-input range-max"
                         min="<%= price_range[:min] %>"
                         max="<%= price_range[:max] %>"
                         value="<%= current_max_price %>"
                         data-<%= controller_name %>-target="rangeMax"
                         data-action="input-><%= controller_name %>#updatePriceRange">
                </div>
              </div>

              <div class="flex items-center justify-between text-sm text-muted">
                <span data-<%= controller_name %>-target="minPriceDisplay">$<%= current_min_price %></span>
                <span data-<%= controller_name %>-target="maxPriceDisplay">$<%= current_max_price %></span>
              </div>
            </div>
          </div>
        <% end %>

        <!-- Product Type -->
        <% if filter_form.filter_available?(:product_types) && product_type_options.any? %>
          <div class="filter-section">
            <button type="button"
                    class="filter-section-header"
                    data-action="click-><%= controller_name %>#toggleSection"
                    data-section="product-type"
                    aria-expanded="false">
              <span class="text-base font-medium">Product Type</span>
              <%= render IconComponent.new(name: :chevron_down, class: "w-5 h-5 text-subtle transform transition-transform") %>
            </button>

            <div class="filter-section-content hidden" data-section-content="product-type">
              <div class="space-y-3 mt-4 max-h-48 overflow-y-auto">
                <% product_type_options.each do |option| %>
                  <label class="flex items-center">
                    <input type="checkbox"
                           name="filters[product_types][]"
                           value="<%= option[:value] %>"
                           <%= 'checked' if filter_selected?('product_types', option[:value]) %>
                           data-action="change-><%= controller_name %>#updateFilter"
                           data-filter-type="product_types"
                           class="form-checkbox-interactive">
                    <span class="ml-2 text-sm text-secondary"><%= option[:label] %></span>
                  </label>
                <% end %>
              </div>
            </div>
          </div>
        <% end %>

        <!-- Brands (only show if not in brand context) -->
        <% if filter_form.filter_available?(:brands) && brand_options.any? %>
          <div class="filter-section">
            <button type="button"
                    class="filter-section-header"
                    data-action="click-><%= controller_name %>#toggleSection"
                    data-section="brands"
                    aria-expanded="false">
              <span class="text-base font-medium">Brands</span>
              <%= render IconComponent.new(name: :chevron_down, class: "w-5 h-5 text-subtle transform transition-transform") %>
            </button>

            <div class="filter-section-content hidden" data-section-content="brands">
              <div class="space-y-3 mt-4 max-h-48 overflow-y-auto">
                <% brand_options.each do |option| %>
                  <label class="flex items-center">
                    <input type="checkbox"
                           name="filters[brands][]"
                           value="<%= option[:value] %>"
                           <%= 'checked' if filter_selected?('brands', option[:value]) %>
                           data-action="change-><%= controller_name %>#updateFilter"
                           data-filter-type="brands"
                           class="form-checkbox-interactive">
                    <span class="ml-2 text-sm text-secondary"><%= option[:label] %></span>
                  </label>
                <% end %>
              </div>
            </div>
          </div>
        <% end %>

        <!-- Colors -->
        <% if filter_form.filter_available?(:colors) && available_colors.any? %>
          <div class="filter-section">
            <button type="button"
                    class="filter-section-header"
                    data-action="click-><%= controller_name %>#toggleSection"
                    data-section="colors"
                    aria-expanded="false">
              <span class="text-base font-medium">Colors</span>
              <%= render IconComponent.new(name: :chevron_down, class: "w-5 h-5 text-subtle transform transition-transform") %>
            </button>

            <div class="filter-section-content hidden" data-section-content="colors">
              <div class="space-y-3 mt-4 max-h-48 overflow-y-auto">
                <% available_colors.each do |color| %>
                  <label class="flex items-center">
                    <input type="checkbox"
                           name="filters[colors][]"
                           value="<%= color[:value] %>"
                           <%= 'checked' if filter_selected?('colors', color[:value]) %>
                           data-action="change-><%= controller_name %>#updateFilter"
                           data-filter-type="colors"
                           class="form-checkbox-interactive">
                    <span class="ml-2 text-sm text-secondary"><%= color[:label] %></span>
                  </label>
                <% end %>
              </div>
            </div>
          </div>
        <% end %>

        <!-- Sizes -->
        <% if filter_form.filter_available?(:sizes) && available_sizes.any? %>
          <div class="filter-section">
            <button type="button"
                    class="filter-section-header"
                    data-action="click-><%= controller_name %>#toggleSection"
                    data-section="sizes"
                    aria-expanded="false">
              <span class="text-base font-medium">Sizes</span>
              <%= render IconComponent.new(name: :chevron_down, class: "w-5 h-5 text-subtle transform transition-transform") %>
            </button>

            <div class="filter-section-content hidden" data-section-content="sizes">
              <div class="space-y-3 mt-4 max-h-32 overflow-y-auto">
                <% available_sizes.each do |size| %>
                  <label class="flex items-center">
                    <input type="checkbox"
                           name="filters[sizes][]"
                           value="<%= size[:value] %>"
                           <%= 'checked' if filter_selected?('sizes', size[:value]) %>
                           data-action="change-><%= controller_name %>#updateFilter"
                           data-filter-type="sizes"
                           class="form-checkbox-interactive">
                    <span class="ml-2 text-sm text-secondary"><%= size[:label] %></span>
                  </label>
                <% end %>
              </div>
            </div>
          </div>
        <% end %>

        <!-- Skin Type -->
        <% if filter_form.filter_available?(:skin_types) && skin_type_options.any? %>
          <div class="filter-section">
            <button type="button"
                    class="filter-section-header"
                    data-action="click-><%= controller_name %>#toggleSection"
                    data-section="skin-type"
                    aria-expanded="false">
              <span class="text-base font-medium">Skin Type</span>
              <%= render IconComponent.new(name: :chevron_down, class: "w-5 h-5 text-subtle transform transition-transform") %>
            </button>

            <div class="filter-section-content hidden" data-section-content="skin-type">
              <div class="space-y-3 mt-4">
                <% skin_type_options.each do |option| %>
                  <label class="flex items-center">
                    <input type="checkbox"
                           name="filters[skin_types][]"
                           value="<%= option[:value] %>"
                           <%= 'checked' if filter_selected?('skin_types', option[:value]) %>
                           data-action="change-><%= controller_name %>#updateFilter"
                           data-filter-type="skin_types"
                           class="form-checkbox-interactive">
                    <span class="ml-2 text-sm text-secondary"><%= option[:label] %></span>
                  </label>
                <% end %>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    </div>

    <div class="p-6">
      <div class="flex gap-3">
        <button type="button"
                class="btn-secondary flex-1 disabled:opacity-50 disabled:cursor-not-allowed"
                data-<%= controller_name %>-target="resetButton"
                data-action="click-><%= controller_name %>#resetFilters">
          Reset
        </button>
        <button type="button"
                class="flex-1 px-4 py-2 bg-interactive text-white font-semibold rounded-lg hover:bg-interactive-dark transition-colors"
                data-action="click-><%= controller_name %>#applyFilters">
          Apply Filters
        </button>
      </div>
    </div>
  </div>
</div>
