<!-- Variant Selection Form -->
<div>
  <%= form_with model: product, url: update_variant_product_path(product), method: :patch, local: false,
      data: {
        "products--variant-selector-target": "form",
        action: "change->products--variant-selector#submitForm"
      } do |form| %>
    <!-- Product Options Section -->
    <div class="space-y-6 py-6">
      <!-- Size Selection -->
      <% if has_sizes? %>
        <div class="space-y-4">
          <label class="text-sm font-semibold uppercase tracking-wide">
            <%= size_type_label %>
          </label>
          <div class="flex flex-wrap gap-3">
            <% variant_options[:sizes].each_with_index do |size_option, index| %>
              <label class="cursor-pointer relative">
                <%= form.radio_button :size, size_option.value,
                    checked: (default_size_option&.value == size_option.value) || (default_size_option.nil? && index == 0),
                    class: "sr-only peer",
                    data: { 
                      "products--variant-selector-target": "sizeOption",
                      "available": variant_available?(size_option.variant_id)
                    } %>
                <!-- Size Button -->
                <div class="size-option <%= variant_available?(size_option.variant_id) ? 'size-option--available peer-checked:size-option--selected' : 'size-option--unavailable peer-checked:size-option--selected' %>">
                  <!-- Size Text -->
                  <span class="<%= 'text-subtle' unless variant_available?(size_option.variant_id) %> text-center leading-tight">
                    <%= size_option.name %>
                  </span>
                  <!-- Unavailable Diagonal Strikethrough -->
                  <% unless variant_available?(size_option.variant_id) %>
                    <svg class="absolute inset-0 w-full h-full pointer-events-none" viewBox="0 0 50 50">
                      <line x1="0" y1="0" x2="50" y2="50" stroke="#d1d5db" stroke-width="1.5" stroke-linecap="round"/>
                    </svg>
                  <% end %>
                </div>
              </label>
            <% end %>
          </div>
        </div>
      <% end %>
      <!-- Color Selection -->
      <% if has_colors? %>
        <div data-controller="products--color-dropdown"
            data-products--color-dropdown-selected-value-value="<%= first_color_option.value %>"
            data-products--color-dropdown-selected-name-value="<%= first_color_option.name %>"
            data-products--color-dropdown-placeholder-value="<%= I18n.t('products.color_dropdown.placeholder') %>">
          <%= form.hidden_field :color,
              value: first_color_option.value,
              data: {
                "products--color-dropdown-target": "hiddenInput",
                "products--variant-selector-target": "colorOption"
              } %>
          <!-- Dropdown Button -->
          <div class="relative">
            <button type="button"
                    class="color-dropdown-button group"
                    data-products--color-dropdown-target="button"
                    data-action="click->products--color-dropdown#toggle">
              <div class="flex items-center space-x-3">
                <!-- Selected Color Circle -->
                <div class="color-circle"
                    data-products--color-dropdown-target="selectedColor"
                    style="--selected-color: <%= first_color_option.value.downcase %>;">
                </div>
                <!-- Selected Color Text -->
                <span class="font-medium text-base group-hover:text-interactive transition-colors"
                      data-products--color-dropdown-target="selectedText">
                  <%= first_color_option.name %>
                </span>
              </div>
              <!-- Dropdown Arrow -->
              <%= render UI::IconComponent.new(name: :chevron_down, css_class: "w-5 h-5 text-primary group-hover:text-interactive transition-transform duration-200", "data-products--color-dropdown-target": "arrow") %>
            </button>
            <!-- Dropdown Menu -->
            <div class="color-dropdown-menu absolute z-50 w-full mt-1 bg-white border border-gray-200 rounded-md shadow-lg opacity-0 pointer-events-none scale-95 transition-all duration-200 origin-top"
                data-products--color-dropdown-target="menu">
              <div class="py-1 max-h-64 overflow-y-auto scrollbar-thin">
                <% variant_options[:colors].each do |color_option| %>
                  <button type="button"
                          class="color-dropdown-menu-item <%= 'color-dropdown-menu-item--out-of-stock' unless variant_available?(color_option.variant_id) %> w-full text-left focus:outline-none transition-colors space-x-3 group"
                          data-action="click->products--color-dropdown#selectColor"
                    data-value="<%= color_option.value %>"
                    data-name="<%= color_option.name %>"
                    data-color-hex="<%= color_option.value %>">
                    <!-- Color Circle -->
                    <div class="color-circle <%= 'color-circle--out-of-stock' unless variant_available?(color_option.variant_id) %>"
                        style="--selected-color: <%= color_option.value.downcase %>;">
                    </div>
                    <!-- Color Name -->
                    <span class="<%= variant_available?(color_option.variant_id) ? 'group-hover:text-interactive' : '' %> transition-colors"><%= color_option.name %></span>
                  </button>
                <% end %>
              </div>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  <% end %>
</div>
