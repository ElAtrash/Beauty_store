<%= helpers.turbo_frame_tag turbo_frame_id,
    class: "product-cart-actions",
    data: {
      controller: "cart-actions",
      cart_actions_product_id_value: product.id
    } do %>
  <% if cart_item.present? %>
    <!-- Quantity Mode -->
    <div class="product-actions flex items-start gap-3" data-cart-state="quantity">
      <div class="flex-1">
        <div class="add-to-cart-button w-full flex items-center px-0">
          <%= button_to cart_item_path(cart_item),
              method: :patch,
              params: { cart_item: { quantity: cart_item.quantity - 1 } },
              class: "aspect-square h-full flex items-center justify-center text-white border-0 bg-transparent px-3",
              data: {
                turbo_frame: turbo_frame_id
              } do %>
            <%= render UI::IconComponent.new(name: :minus, css_class: "w-[var(--cart-button-icon-size)] h-[var(--cart-button-icon-size)]") %>
          <% end %>
          <span class="flex-1 text-center font-medium text-white px-2">
            <%= cart_item.quantity %>
          </span>
          <%= button_to cart_item_path(cart_item),
              method: :patch,
              params: { cart_item: { quantity: cart_item.quantity + 1 } },
              class: "aspect-square h-full flex items-center justify-center text-white border-0 bg-transparent px-3",
              data: {
                turbo_frame: turbo_frame_id
              } do %>
            <%= render UI::IconComponent.new(name: :plus, css_class: "w-[var(--cart-button-icon-size)] h-[var(--cart-button-icon-size)]") %>
          <% end %>
        </div>
      </div>
      <!-- Wishlist -->
      <%= render "shared/wishlist_button" %>
    </div>
  <% else %>
    <!-- Initial Mode -->
    <div class="product-actions flex items-center gap-3" data-cart-state="initial">
      <div class="flex-1">
        <%= form_with url: cart_items_path,
            method: :post,
            data: { turbo_frame: turbo_frame_id },
            class: "cart-add-form" do |form| %>
          <%= form.hidden_field :product_variant_id, value: current_variant&.id %>
          <%= form.hidden_field :quantity, value: 1 %>
          <% if stock_available? %>
            <%= form.submit "ADD TO CART",
                class: "add-to-cart-button w-full",
                data: {
                  turbo_submits_with: "Adding...",
                  disable_with: "Adding..."
                } %>
          <% else %>
            <%= form.submit "NOTIFY ME",
                class: "add-to-cart-button w-full notify-mode",
                data: {
                  turbo_submits_with: "Notifying...",
                  disable_with: "Notifying..."
                } %>
          <% end %>
        <% end %>
      </div>
      <!-- Wishlist -->
      <%= render "shared/wishlist_button" %>
    </div>
  <% end %>
<% end %>