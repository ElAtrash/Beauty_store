<%= helpers.turbo_frame_tag turbo_frame_id,
    class: "product-cart-actions",
    data: {
      controller: "cart-actions",
      cart_actions_product_id_value: product.id
    } do %>
  <% if cart_item.present? %>
    <!-- Quantity Mode -->
    <div class="product-actions flex items-start gap-3" data-cart-state="quantity">
      <div class="flex-1">
        <%= form_with model: cart_item,
            url: update_quantity_cart_item_path(cart_item),
            method: :patch,
            data: {
              turbo_frame: turbo_frame_id,
              action: "submit->cart-actions#handleFormSubmit"
            },
            class: "cart-quantity-form" do |form| %>
          <div class="add-to-cart-button w-full flex items-center px-0">
            <button type="submit"
                    class="aspect-square h-full flex items-center justify-center text-white border-0 bg-transparent"
                    name="quantity_action"
                    value="decrement">
              <%= render UI::IconComponent.new(name: :minus, css_class: "w-[var(--cart-button-icon-size)] h-[var(--cart-button-icon-size)]") %>
            </button>
            <span class="flex-1 text-center font-medium text-white">
              <%= cart_item.quantity %>
            </span>
            <button type="submit"
                    class="aspect-square h-full flex items-center justify-center text-white border-0 bg-transparent"
                    name="quantity_action"
                    value="increment">
              <%= render UI::IconComponent.new(name: :plus, css_class: "w-[var(--cart-button-icon-size)] h-[var(--cart-button-icon-size)]") %>
            </button>
          </div>
        <% end %>
      </div>
      <!-- Wishlist -->
      <%= render "shared/wishlist_button" %>
    </div>
  <% else %>
    <!-- Initial Mode -->
    <div class="product-actions flex items-center gap-3" data-cart-state="initial">
      <div class="flex-1">
        <%= form_with url: cart_items_path,
            method: :post,
            data: { turbo_frame: turbo_frame_id },
            class: "cart-add-form" do |form| %>
          <%= form.hidden_field :product_variant_id, value: current_variant&.id %>
          <%= form.hidden_field :quantity, value: 1 %>
          <% if stock_available? %>
            <%= form.submit "ADD TO CART",
                class: "add-to-cart-button w-full",
                data: {
                  turbo_submits_with: "Adding...",
                  disable_with: "Adding..."
                } %>
          <% else %>
            <%= form.submit "NOTIFY ME",
                class: "add-to-cart-button w-full notify-mode",
                data: {
                  turbo_submits_with: "Notifying...",
                  disable_with: "Notifying..."
                } %>
          <% end %>
        <% end %>
      </div>
      <!-- Wishlist -->
      <%= render "shared/wishlist_button" %>
    </div>
  <% end %>
<% end %>