<div class="space-y-4"
     data-controller="products--gallery">

  <!-- Main Image Area with Overlaid Thumbnails -->
  <div class="relative">
    <div class="relative aspect-[4/3] bg-gray-50 overflow-hidden shadow-sm">
      <% if main_image.attached? %>
        <img src="<%= image_url(main_image.attachment, size: :large) %>"
             alt="<%= main_image.safe_alt %>"
             width="800"
             height="600"
             class="w-full h-full object-cover transition-opacity duration-200"
             data-products--gallery-target="mainImage">
      <% else %>
        <div class="w-full h-full flex items-center justify-center">
          <img src="<%= placeholder_url %>"
               alt="<%= main_image.safe_alt %>"
               width="800"
               height="600"
               class="w-full h-full object-cover"
               data-products--gallery-target="mainImage">
        </div>
      <% end %>

      <!-- Left Click Zone for Previous Image -->
      <% if thumbnail_images.size > 1 %>
        <div class="gallery-click-zone gallery-click-zone--left"
             style="cursor: url('<%= cursor_data_url(:cursor_left) %>') 16 16, pointer;"
             data-action="click->products--gallery#previousImage">
        </div>
      <% end %>

      <!-- Right Click Zone for Next Image -->
      <% if thumbnail_images.size > 1 %>
        <div class="gallery-click-zone gallery-click-zone--right"
             style="cursor: url('<%= cursor_data_url(:cursor_right) %>') 16 16, pointer;"
             data-action="click->products--gallery#nextImage">
        </div>
      <% end %>

      <!-- Center Click Zone for Zoom -->
      <div class="gallery-click-zone gallery-click-zone--center"
           style="cursor: url('<%= cursor_data_url(:cursor_zoom) %>') 16 16, pointer;"
           data-action="click->products--gallery#zoomImage">
      </div>


      <!-- Sale Badge -->
      <% if product.default_variant&.on_sale? %>
        <div class="absolute top-4 left-4 z-20">
          <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-pink-600 text-white">
            -<%= product.default_variant.discount_percentage %>%
          </span>
        </div>
      <% end %>
    </div>

    <!-- Overlaid Thumbnail Stack -->
    <% if thumbnail_images.size > 1 %>
      <!-- Desktop: Vertical thumbnail overlay -->
      <div class="hidden lg:block absolute left-4 top-1/2 -translate-y-1/2 z-30">
        <%= render "products/thumbnail_list",
            images: thumbnail_images,
            context: :desktop,
            product: product,
            component: self,
            show_arrows: responsive_thumbnail_config[:show_arrows],
            container_height: thumbnail_container_height %>
      </div>

      <!-- Mobile: Horizontal thumbnails below -->
      <div class="lg:hidden mt-4">
        <%= render "products/thumbnail_list",
            images: thumbnail_images,
            context: :mobile,
            product: product,
            component: self %>
      </div>
    <% end %>

    <!-- Image Counter -->
    <% if gallery_images.size > 1 %>
      <div class="flex justify-center mt-4 lg:hidden">
        <span class="text-sm text-gray-500">
          <span data-products--gallery-target="currentIndex">1</span> / <%= gallery_images.size %>
        </span>
      </div>
    <% end %>
  </div>

  <!-- Gallery Modal Component -->
  <%= render Products::GalleryModalComponent.new(
        product: product,
        gallery_images: gallery_images,
        current_image_index: 0
      ) %>
</div>
