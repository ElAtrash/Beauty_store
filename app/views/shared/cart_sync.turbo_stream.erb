<!-- Badge updates (both desktop + mobile) -->
<%= turbo_stream.replace "cart-badge" do %>
  <div id="cart-badge" class="relative">
    <%= render UI::HeaderActionButtonComponent.new(
        icon: 'shopping_cart',
        action: 'application#openCart',
        aria_label: I18n.t('header.actions.cart'),
        badge: cart&.total_quantity&.positive? ? cart.total_quantity : nil) %>
  </div>
<% end %>
<%= turbo_stream.replace "mobile-cart-badge" do %>
  <div id="mobile-cart-badge" class="relative">
    <%= render UI::HeaderActionButtonComponent.new(
        icon: 'shopping_cart',
        action: 'application#openCart',
        aria_label: I18n.t('header.actions.cart'),
        badge: cart&.total_quantity&.positive? ? cart.total_quantity : nil) %>
  </div>
<% end %>
<%= turbo_stream.replace "cart-popup-body" do %>
  <div id="cart-popup-body" class="flex flex-col h-full">
    <%= render Cart::PopupComponent.new(cart: cart) %>
  </div>
<% end %>
<!-- Product page controls (if variant provided) -->
<% if defined?(variant) && variant.present? %>
  <%= turbo_stream.replace "cart-actions-#{variant.product.id}" do %>
    <%= render "products/cart_actions",
        product: variant.product,
        variant: variant %>
  <% end %>
<% end %>
<!-- Product page controls (if cleared_variants provided for clear_all) -->
<% if defined?(cleared_variants) && cleared_variants.present? %>
  <% cleared_variants.each do |cleared_variant| %>
    <%= turbo_stream.replace "cart-actions-#{cleared_variant.product.id}" do %>
      <%= render "products/cart_actions",
          product: cleared_variant.product,
          variant: cleared_variant %>
    <% end %>
  <% end %>
<% end %>
<!-- Rich notification with product details -->
<% if defined?(notification) && notification.present? %>
  <%= turbo_stream.prepend "notifications" do %>
    <div class="notification notification-<%= notification[:type] || 'success' %>"
         data-controller="auto-dismiss"
         data-auto-dismiss-delay-value="<%= notification[:delay] || 3000 %>">
      <% if notification[:cart_item] && notification[:type] == 'success' %>
        <!-- Rich cart notification -->
        <div class="flex items-center gap-3">
          <!-- Product image -->
          <div class="w-12 h-12 rounded overflow-hidden bg-gray-100 flex-shrink-0">
            <% if notification[:cart_item].product_variant.featured_image.attached? %>
              <%= image_tag notification[:cart_item].product_variant.featured_image,
                            alt: notification[:cart_item].product_variant.product.name,
                            class: "w-full h-full object-cover" %>
            <% else %>
              <div class="w-full h-full flex items-center justify-center text-gray-400">
                <%= render UI::IconComponent.new(name: :sparkles, css_class: "w-4 h-4") %>
              </div>
            <% end %>
          </div>
          <!-- Product details -->
          <div class="flex-1 min-w-0">
            <div class="font-medium text-sm flex items-center gap-1">
              <%= render UI::IconComponent.new(name: :shopping_cart, css_class: "w-3 h-3") %>
              Added to cart!
            </div>
            <div class="text-sm opacity-90 truncate">
              <%= notification[:cart_item].product_variant.product.name %>
            </div>
            <div class="text-xs opacity-80">
              <%= notification[:cart_item].quantity %> unit<%= notification[:cart_item].quantity != 1 ? 's' : '' %>
            </div>
          </div>
        </div>
      <% else %>
        <!-- Simple notification fallback -->
        <div class="flex items-center">
          <% icon = case notification[:type] %>
          <% when 'success' %>
            <%= render UI::IconComponent.new(name: :sparkles, css_class: "w-5 h-5 mr-2") %>
          <% when 'error' %>
            <%= render UI::IconComponent.new(name: :close, css_class: "w-5 h-5 mr-2") %>
          <% when 'info' %>
            <%= render UI::IconComponent.new(name: :minus, css_class: "w-5 h-5 mr-2") %>
          <% else %>
            <%= render UI::IconComponent.new(name: :sparkles, css_class: "w-5 h-5 mr-2") %>
          <% end %>
          <span><%= notification[:message] %></span>
        </div>
      <% end %>
    </div>
  <% end %>
<% end %>
