<div class="brand-detail-page">
  <!-- Brand Banner -->
  <%= render Brands::BrandBannerComponent.new(brand: @brand) %>

  <!-- Brand Filters -->
  <div class="bg-white"
       data-controller="filters--filter"
       data-filters--filter-turbo-frame-id-value="brand_products_<%= @brand.id %>"
       data-filters--filter-context-value="brand">
    <div class="container mx-auto px-4 pt-4 pb-2">
      <div class="flex justify-between items-center mb-4">
        <div class="flex items-center gap-6">
          <button type="button"
                  class="filter-toggle-button"
                  data-action="click->filters--filter#openFilters">
            <%= render IconComponent.new(name: :adjustments_horizontal, class: "w-5 h-5") %>
            Filters
          </button>

          <div class="relative" data-controller="sort-dropdown">
            <button type="button"
                    class="sort-dropdown-button"
                    data-action="click->sort-dropdown#toggle"
                    data-sort-dropdown-target="button">
              <span data-sort-dropdown-target="selectedText">
                <%= ProductFilterForm::SORT_OPTIONS[@filter_form.sort_by] || "Most Popular" %>
              </span>
              <svg class="w-4 h-4 transition-transform duration-200"
                    data-sort-dropdown-target="arrow"
                    fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
              </svg>
            </button>

            <div class="absolute top-full right-0 mt-1 w-48 bg-white border border-gray-200 rounded-lg shadow-lg z-50 opacity-0 pointer-events-none transition-all duration-200 transform scale-95"
                  data-sort-dropdown-target="menu">
              <% ProductFilterForm::SORT_OPTIONS.each do |value, label| %>
                <button type="button"
                        class="w-full text-left px-3 py-2 text-sm text-secondary hover:text-interactive transition-colors first:rounded-t-lg last:rounded-b-lg"
                        data-action="click->sort-dropdown#selectOption"
                        data-value="<%= value %>">
                  <%= label %>
                </button>
              <% end %>
            </div>
          </div>
        </div>

        <div class="text-base text-secondary font-medium">
          <%= @pagy.count %> <%= 'product'.pluralize(@pagy.count) %>
        </div>
      </div>
    </div>

    <%= render FilterComponent.new(
          filter_form: @filter_form,
          products: @filter_products,
          unfiltered_products: @unfiltered_products,
          context: 'brand',
          context_resource: @brand,
          turbo_frame_id: "brand_products_#{@brand.id}"
        ) %>
  </div>

  <!-- Brand Products -->
  <%= turbo_frame_tag "brand_products_#{@brand.id}" do %>
    <%= render Brands::BrandProductListComponent.new(brand: @brand, products: @products, pagy: @pagy) %>
  <% end %>

  <!-- Brand Description -->
  <%= render Brands::BrandDescriptionComponent.new(brand: @brand) %>
</div>
