<div class="cart-items-list overflow-x-hidden px-20">
  <% cart_items.each_with_index do |cart_item, index| %>
    <div class="cart-item flex gap-6 py-8 border-b border-gray-100 last:border-b-0 hover:bg-gray-50 transition-all duration-200 rounded-lg px-4 -mx-4" 
         data-cart-item-id="<%= cart_item.id %>">
      <!-- Product Image -->
      <div class="flex-shrink-0 w-24 h-24 bg-gray-100 rounded overflow-hidden">
        <% if cart_item.product_variant.featured_image.attached? %>
          <%= image_tag cart_item.product_variant.featured_image,
                        alt: "#{cart_item.product_variant.product.name}",
                        class: "w-full h-full object-cover" %>
        <% else %>
          <div class="w-full h-full flex items-center justify-center text-gray-400">
            <%= render UI::IconComponent.new(name: :sparkles, css_class: "w-6 h-6") %>
          </div>
        <% end %>
      </div>

      <!-- Product Details -->
      <div class="flex-1 min-w-0 flex flex-col h-24">
        <div class="flex justify-between items-start flex-1">
          <div class="flex-1 min-w-0">
            <!-- Product Category -->
            <p class="text-xs uppercase tracking-wide text-gray-500 mb-1">
              <%= cart_item.product_variant.product.categories.first&.name || "PRODUCT" %>
            </p>

            <!-- Product Name -->
            <h3 class="font-medium text-sm leading-tight mb-1">
              <%= cart_item.product_variant.product.name %>
            </h3>

            <!-- Variant Details -->
            <div class="flex items-center gap-2 text-xs text-gray-600">
              <% if cart_item.product_variant.size? %>
                <span><%= cart_item.product_variant.formatted_size_value || cart_item.product_variant.size_value %> <%= cart_item.product_variant.size_unit %></span>
              <% end %>

              <% if cart_item.product_variant.color? %>
                <span class="flex items-center gap-1">
                  |
                  <div class="w-3 h-3 rounded-full border border-gray-300"
                       style="background-color: <%= cart_item.product_variant.color_hex %>"></div>
                  <%= cart_item.product_variant.color&.upcase %>
                </span>
              <% end %>
            </div>
          </div>

          <!-- Compact Quantity Controls -->
          <div class="flex items-center gap-1">
            <%= form_with model: cart_item,
                url: update_quantity_cart_item_path(cart_item),
                method: :patch,
                data: {
                  turbo_frame: "_top"
                },
                class: "contents" do |form| %>

              <button type="submit"
                      class="w-6 h-6 rounded-full bg-gray-50 hover:bg-gray-100 hover:scale-105 flex items-center justify-center text-text-primary hover:text-interactive-primary transition-all duration-150"
                      name="quantity_action"
                      value="decrement">
                <%= render UI::IconComponent.new(name: :minus, css_class: "w-4 h-4") %>
              </button>

              <span class="min-w-[2rem] text-center text-sm font-medium">
                <%= cart_item.quantity %>
              </span>

              <button type="submit"
                      class="w-6 h-6 rounded-full bg-gray-50 hover:bg-gray-100 hover:scale-105 flex items-center justify-center text-text-primary hover:text-interactive-primary transition-all duration-150"
                      name="quantity_action"
                      value="increment">
                <%= render UI::IconComponent.new(name: :plus, css_class: "w-4 h-4") %>
              </button>

              <%= form.hidden_field :quantity, value: cart_item.quantity, id: "cart_item_quantity_#{cart_item.id}" %>
            <% end %>

            <%= link_to cart_item_path(cart_item),
                        data: {
                          "turbo-method": "delete",
                          turbo_frame: "_top",
                          confirm: "Remove this item from your cart?"
                        },
                        class: "w-8 h-8 rounded-full bg-gray-50 hover:bg-red-50 hover:scale-105 flex items-center justify-center text-text-primary hover:text-red-500 ml-3 transition-all duration-150" do %>
              <%= render UI::IconComponent.new(name: :close, css_class: "w-4 h-4") %>
            <% end %>
          </div>
        </div>

        <!-- Price aligned with bottom -->
        <div class="flex justify-end">
          <p class="font-medium text-sm">
            <%= cart_item.unit_price.format %>
          </p>
        </div>
      </div>
    </div>
  <% end %>
</div>
